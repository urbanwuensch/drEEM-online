<img src="top right corner logo.png" width="100" height="auto" align="right"/>

# pickpeaks
Extract common fluorescence peaks and indices from a drEEMdataset object.




## Syntax
[`dataout = pickpeaks(data)`](#syntax1)


[`dataout = pickpeaks( ___ , Name,Value)`](#syntax2)

[`pickpeaks( ___ , Name,Value)`](#syntax3)

## Description

The function returns fluorescence intensities and ratios at predefined points in the EEM for every sample.

> ***Note:*** Data coverage differs between datasets. If a peak or index is out of the range covered by the measurements, NaNs will be returned. If the distance between the peak definition and the measurements is equal to or greater than 5nm, a message will be displayed to disclose this. The function does not and cannot perform interpolations to solve the issue.

1. **Peak Extraction:**<br>
	1. Single Point: The peak value is taken directly from the specified Em/Ex pair.
	2. Max over Range: The peak value is the maximum fluorescence intensity within the specified Em and/or Ex range.
2. **Fluorescence Indices:**<br>
	1. Fluorescence Index (FluI): Ratio of fluorescence intensities at `Em=470` nm and `Em=520` nm for `Ex=370` nm.
	2. Freshness Index (FrI): Ratio of fluorescence intensities at `Em=380` nm and the maximum intensity between `Em=420` nm and `Em=435` nm for `Ex=310` nm.
	3. Biological Index (BIX): Ratio of fluorescence intensities at `Em=380` nm and `Em=430` nm for `Ex=310` nm.
	4. Humification Index (HIX): Ratio of the sum of fluorescence intensities between `Em=435` nm and `Em=480` nm to the sum of intensities between `Em=300` nm and `Em=345` nm plus `Em=435` nm and `Em=480` nm for `Ex=254` nm.

> ***Info:*** For fluorescence indices, the emission scans in question are smoothed using `smoothdata(___,'sgolay',2)`. Verify with `pickpeaks(data,details=true)` if this represents _your_ data well in _your_ case.

<table border="1">
    <tr>
        <th>Peak Name/ Fluorescence Indices</th>
        <th>Emission Wavelengths (nm)</th>
        <th>Excitation Wavelengths (nm)</th>
        <th>Type</th>

    </tr>
    <tr>
        <td>B</td>
        <td>305</td>
        <td>275</td>
        <td>Single Point</td>
    </tr>
    <tr>
        <td>T</td>
        <td>340</td>
        <td>275</td>
        <td>Single Point</td>
    </tr>
    <tr>
        <td>A</td>
        <td>400-460</td>
        <td>260</td>
        <td>Max over Range</td>
    </tr>
    <tr>
        <td>M</td>
        <td>370-410</td>
        <td>290-310</td>
        <td>Max over Range</td>

    </tr>
    <tr>
        <td>C</td>
        <td>420-460</td>
        <td>320-360</td>
        <td>Max over Range</td>

    </tr>
    <tr>
        <td>D</td>
        <td>509</td>
        <td>390</td>
        <td>Single Point</td>

    </tr>
    <tr>
        <td>N</td>
        <td>370</td>
        <td>280</td>
        <td>Single Point</td>

    </tr>
    <tr>
        <td>Fluorescence Index (FluI)</td>
        <td>470, 520</td>
        <td>370</td>
        <td>Ratio</td>

    </tr>
    <tr>
        <td>Freshness Index (FrI)</td>
        <td>380, 420-435</td>
        <td>310</td>
        <td>Ratio</td>

    </tr>
    <tr>
        <td>Biological Index (BIX)</td>
        <td>380, 430</td>
        <td>310</td>
        <td>Ratio</td>

    </tr>
    <tr>
        <td>Humification Index (HIX)</td>
        <td>300-345, 435-480</td>
        <td>254</td>
        <td>Ratio</td>

    </tr>
</table>

Pickes predefined peaks and fluorescence indices in the EEM and stores the results in `dataout.opticalMetadata`.

<details open>
<summary>
<b>`dataout = pickpeaks(data)` - extract peaks and indices from dataset</b>
</summary>
 <a name="syntax1"></a>
Th function `pickpeaks` extracts predefined fluorescence peaks, including Peak B, T, A, M, C, D, and N, and computes several fluorescence indices, including Fluorescence index (FluI), Freshness Index (FrI), Biological Index (BIX) and Humification Index (HIX), from `data`. The peaks and indices will be plotted for all the samples in `data`.

</details>


<details open>
<summary>
<b>`dataout = pickpeaks( ___ , Name,Value) ` - control visual output with arguments </b>
</summary>
<a name="syntax2"></a>

specifies additional options using one or more [name-value](#NameValue) pair arguments. For example, you can specify if the overview plot should be generated by using `'plot','true'` and specify if indices diagnostic plots should be displayed for each sample by using `'details','true'`. 

</details>

<details open>
<summary>
<b>`pickpeaks(data) ` - run the function in diagnostic mode</b>
</summary>
<a name="syntax3"></a>

If no output argument is provided, the function will automatically set `plot=true` and `details=true` to provide diagnostic plots that describe the peack picking process in more detail.

</details>

## Input arguments
<details>
    <summary><b>`data` - contains sample fluorescence</b></summary>
    <i>drEEMdataset</i>
        
A dataset of the class `drEEMdataset` that passes the validation function `tbx.validatedataset(data)`.

</details>



## Name-Value arguments
Specify pairs of arguments as `Name1=Value1,...,NameN=ValueN`, where `Name` is the argument name and `Value` is the corresponding value. The notation `"Name",Value` is also supported. Name-value arguments must appear after other arguments, `data` in this case, but the order of the pairs does not matter. 
<a name="NameValue"></a>

<details open>
    <summary><b>`plot`- switch to plot the results</b></summary>
    <i>logical</i>

Logical or numeric value to specify if a plot showing the results should be generated. The plot shows an overview of peak intensities and indices for all sample in `data`. If no output argument is supplied, plotting is enabled automatically.

Default is `true`.

</details>


<details open>
    <summary><b>`details `- switch to plot diagnostics</b></summary>
    <i>logical</i>

Logical or numeric value to specify if detailed diagnostic plots should be shown for each sample. This mainly concerns the indices as some smoothing of the data is done in an attempt to obtain more robust results. Use this option to verify that this smoothing works well.

Default is `false`.

</details>

## Output arguments

<details open>
    <summary><b>`dataout` - contains results</b></summary>
    <i>drEEMdataset</i>
        
A dataset of the class `drEEMdataset` that passes the validation function `tbx.validatedataset(dataout)`. The output contains the results in the table `.opticalMetadata`
</details>