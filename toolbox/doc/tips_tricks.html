<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2024b"><title>Tips and Tricks</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 700; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin-bottom: 20px; padding-bottom: 4px;  }
.S3 { margin: 0px; padding: 10px 0px 10px 5px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 700; text-align: start;  }
.S4 { margin: -1px 0px 0px; padding: 10px 0px 10px 7px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: start;  }
.S5 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 25px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S6 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S7 { border-left: 0px none rgb(33, 33, 33); border-right: 0px none rgb(33, 33, 33); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px; line-height: 15.6px; min-height: 16px; white-space: pre; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;  }
.S8 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-size: 14px;  }
.S9 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }</style></head><body><div class = rtcContent><h1  class = 'S0' id = 'T_0a8c' ><span>Tips and Tricks</span></h1><div  class = 'S1'><span>Depending on the scientific discipline, Matlab is not the most popular choise of scientific programing language for the users of fluorescence spectroscopy. If you spend most of your time in R or Phython, you might find yourself frustrated at not knowing how to do ceratain jobs. If you're mostly using Excel, this might be even more pronounced. </span><span style=' font-weight: bold; font-style: italic; text-decoration: underline;'>Don't worry, this page is for you!</span></div><div  class = 'S1'><span>We will go through several topics that often hinder users of our toolbox in getting to the fun part. Most of this is related to data importing and associated initial tasks. So let's start there.</span></div><div  class = 'S2'><div  class = 'S3'><span style=' font-weight: bold;'>Table of Contents</span></div><div  class = 'S4'><a href = "#H_3c01"><span>Working with filenames
</span></a><a href = "#H_89df"><span>Useful Matlab functionality
</span></a><span>    </span><a href = "#H_537e"><span>Universal script header
</span></a><span>    </span><a href = "#H_547f"><span>Working with filenames
</span></a><a href = "#H_675b"><span>drEEM-specific Tips and Tricks
</span></a><span>    </span><a href = "#H_6268"><span>Correcting filename errors</span></a></div></div><div  class = 'S1'><span></span></div><h2  class = 'S5' id = 'H_3c01' ><span>Working with filenames</span></h2><div  class = 'S1'><span>Often, fluorescence and absorbance are measured on separate instruments. Upon exporting, the filenames will often differ. Sometimes just by the extension (e.g. ".csv" vs. ".dat" or ".txt"), but often they are entirely different.</span></div><div  class = 'S1'><span>If you use </span><a href = "importabsorbance.html"><span style=' font-family: monospace;'>importabsorbance</span></a><span style=' font-family: monospace;'> </span><span>or </span><a href = "importeems.html"><span style=' font-family: monospace;'>importeems</span></a><span>, the common extension part of the filenames (e.g. ".csv") and trailing or leading empty characters are already removed for you. So you don't need to worry about those anymore. Problem solved!</span></div><h2  class = 'S5' id = 'H_89df' ><span>Useful Matlab functionality</span></h2><div  class = 'S1'><span>This section is dedicated to sharing code that the developer team has discovered over the years. This is of course mostly documented already, but you might still find it useful!</span></div><h3  class = 'S6' id = 'H_537e' ><span>Universal script header</span></h3><div  class = 'S1'><span>Once the projects pile up, you find yourself importing a lot of fluorescence data. Wouldn't it be nice to have a script that you can use to import the data? Of course, but a lot of things change between each project, so modifications always seem necessary. But it's all too easy to forget about modifications you made to a script 2 months ago down in line 58 where you loaded and overwrote some variable for some reason. You could start your script as follows:</span></div><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >clearvars</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >close </span><span style="color: #a709f5;">all</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >cd(fileparts(matlab.desktop.editor.getActiveFilename))</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >tbx=drEEMtoolbox;</span></span></div></div><div  class = 'S1'><span>Regardless of what follows, this ensures that all variables are cleared, figures are closed, that you are in fact in the project directory (which is  automatically chosen as the one where the file is saved!) and that drEEM is properly installed.</span></div><div  class = 'S1'><span>Next, standard folder names are a good idea. E.g. store raw data in a folder called "raw data". Separate absorbance data in e.g. "absorbance data". If you don't change these names, you can reuse the same import script. Example to </span><span style=' font-style: italic;'>copy</span><span> (don't try to run it, it will produce errors):</span></div><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >clearvars</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >close </span><span style="color: #a709f5;">all</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >cd(fileparts(matlab.desktop.editor.getActiveFilename))</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >tbx=drEEMtoolbox;</span></span></div><div  class = 'S7'>&nbsp;</div><div  class = 'S7'><span style="white-space: pre"><span >projectName=</span><span style="color: #a709f5;">'someNiceDataset'</span><span >;</span></span></div><div  class = 'S7'>&nbsp;</div><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">if </span><span >not(exist([projectName,</span><span style="color: #a709f5;">'.mat'</span><span >]</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    cd </span><span style="color: #a709f5;">'raw data'</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    samples=tbx.importeems(</span><span style="color: #a709f5;">'* - Waterfall Plot Sample.dat'</span><span >);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    blanks=tbx.importeems(</span><span style="color: #a709f5;">'* - Waterfall Plot Blank.dat'</span><span >);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    absorbance=tbx.importabsorbance(</span><span style="color: #a709f5;">'* - Abs Spectra Graphs.dat'</span><span >);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    cd </span><span style="color: #a709f5;">..</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    save([projectName,</span><span style="color: #a709f5;">'.mat'</span><span >],</span><span style="color: #a709f5;">"samples"</span><span >,</span><span style="color: #a709f5;">"blanks"</span><span >,</span><span style="color: #a709f5;">"absorbance"</span><span >)</span></span></div><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">else</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >    load([projectName,</span><span style="color: #a709f5;">'.mat'</span><span >])</span></span></div><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div  class = 'S1'><span>This code will only import the files if the rawdata mat-file doesn't exist yet (don't do this if you keep adding samples into an ongoing project).</span></div><h3  class = 'S6' id = 'H_547f' ><span>Working with filenames</span></h3><div  class = 'S1'><span>Working with strings, cell array of strings (or characters) is really important. This is where some knowledge of Matlab will pay off. Often, we need to find samples, erase, or replace parts of strings or certain sample names or identify issues when sample datasets need to be aligned. </span><span style=' font-weight: bold; font-style: italic;'>Though, generally, the more attention you pay to sample names and make sure things align at the stage of measuring, the less you need to do in Matlab!</span></div><div  class = 'S1'><span>Some functions that come in extremely handy:</span></div><ul  class = 'S8'><li  class = 'S9'><span style=' font-family: monospace;'>contains</span><span>: Find samples that contain a certain string. No complete match is necessary (though that can be dangerous). But useful particularly if you want to find groups of samples. Example:</span></li></ul><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >idx=contains(data.filelist,</span><span style="color: #a709f5;">'my first bad sample'</span><span >)</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >data=tbx.subdataset(data,outSample=idx);</span></span></div></div><ul  class = 'S8'><li  class = 'S9'><span style=' font-family: monospace;'>matches: </span><span>Much like contains, you'll find samples where the search string is matched </span><span style=' font-style: italic;'>entirely</span><span>. Like </span><span style=' font-family: monospace;'>contains</span><span>, </span><span style=' font-family: monospace;'>matches</span><span> does case-sensitive lookups.</span></li><li  class = 'S9'><span style=' font-family: monospace;'>lower / upper</span><span>: If you have a dataset where upper and lower case is mixed up, these two functions can be a life saver because these mixups are eliminated.</span></li></ul><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >idx=contains(lower(data.filelist),</span><span style="color: #a709f5;">'my first bad sample'</span><span >)</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >data=tbx.subdataset(data,outSample=idx);</span></span></div></div><ul  class = 'S8'><li  class = 'S9'><span style=' font-family: monospace;'>erase</span><span>: Super helpful to fix mismatches between sample logs and filenames. Imagine all filenames in a metadata Excel sheet were typed in with the file extension, but this extension is deleted during the import of the samples. Example:</span></li></ul><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >data.metadata.absorbanceFileName=erase(data.metadata.absorbanceFileName,</span><span style="color: #a709f5;">'.csv'</span><span >)</span></span></div></div><ul  class = 'S8'><li  class = 'S9'><span style=' font-family: monospace;'>intersect</span><span>: A very useful function to find common strings between two lists. drEEMs </span><span style=' font-family: monospace;'>alignsamples</span><span> uses this function and generally will take care of many relevant operations to align different datasets, but it is sometimes necessary to take manual action to figure out what's going wrong when there seems to be little overlap between datasets. Example:</span></li></ul><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >[C,ia,ib] = intersect(samples.filelist,absorbance.filelist)</span></span></div><div  class = 'S7'>&nbsp;</div><div  class = 'S7'><span style="white-space: pre"><span >notMatchedAbs=absorbance.filelist(setdiff(1:absorbance.nSample,ib);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >notMatchedEEM=samples.filelist(setdiff(1:samples.nSample,ia);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >disp(notMatchedAbs)</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >disp(notMatchedEEM)</span></span></div></div><h2  class = 'S5' id = 'H_675b' ><span>drEEM-specific Tips and Tricks</span></h2><h3  class = 'S6' id = 'H_6268' ><span>Correcting filename errors</span></h3><div  class = 'S1'><span>Say you made a mistake in naming one of your samples. It was supposed to be called "PCEP26" but accidentally got called "LCEP26". You could fix the filename(s), but you can also handle this sort of issue in Matlab:</span></div><div class = 'preformatted-matlab' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S7'><span style="white-space: pre"><span >load(</span><span style="color: #a709f5;">"benchmarkDataset.mat"</span><span >)</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >idx=matches(data.filelist,</span><span style="color: #a709f5;">'LCEP26'</span><span >);</span></span></div><div  class = 'S7'><span style="white-space: pre"><span >data.filelist{idx}=</span><span style="color: #a709f5;">'PCEP26'</span><span >;</span></span></div></div><div  class = 'S1'><span>If you're not used to Matlab, the use of "{}" vs. "()" seems strange (especially the third vs. the second line). We chose to store the filenames of your samples in a cell array. This allows us to store character arrays of different lengths together in one variable, but cell arrays can also be a little confusing </span><span style=' font-style: italic;'>because</span><span> they are so flexible as information storage. Luckily, Matlab's internal text-focused functions can and do handle it for us. Long story short, read more </span><a href = "https://www.mathworks.com/help/matlab/cell-arrays.html"><span>here</span></a><span> if you are completely unfamiliar with this.</span></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Tips and Tricks
% Depending on the scientific discipline, Matlab is not the most popular choise 
% of scientific programing language for the users of fluorescence spectroscopy. 
% If you spend most of your time in R or Phython, you might find yourself frustrated 
% at not knowing how to do ceratain jobs. If you're mostly using Excel, this might 
% be even more pronounced. _*Don't worry, this page is for you!*_
% 
% We will go through several topics that often hinder users of our toolbox in 
% getting to the fun part. Most of this is related to data importing and associated 
% initial tasks. So let's start there.
%% 
% 
%% Working with filenames
% Often, fluorescence and absorbance are measured on separate instruments. Upon 
% exporting, the filenames will often differ. Sometimes just by the extension 
% (e.g. ".csv" vs. ".dat" or ".txt"), but often they are entirely different.
% 
% If you use <importabsorbance.html |importabsorbance|> or <importeems.html 
% |importeems|>, the common extension part of the filenames (e.g. ".csv") and 
% trailing or leading empty characters are already removed for you. So you don't 
% need to worry about those anymore. Problem solved!
%% Useful Matlab functionality
% This section is dedicated to sharing code that the developer team has discovered 
% over the years. This is of course mostly documented already, but you might still 
% find it useful!
% Universal script header
% Once the projects pile up, you find yourself importing a lot of fluorescence 
% data. Wouldn't it be nice to have a script that you can use to import the data? 
% Of course, but a lot of things change between each project, so modifications 
% always seem necessary. But it's all too easy to forget about modifications you 
% made to a script 2 months ago down in line 58 where you loaded and overwrote 
% some variable for some reason. You could start your script as follows:
%%
% 
%   clearvars
%   close all
%   cd(fileparts(matlab.desktop.editor.getActiveFilename))
%   tbx=drEEMtoolbox;
%
%% 
% Regardless of what follows, this ensures that all variables are cleared, figures 
% are closed, that you are in fact in the project directory (which is  automatically 
% chosen as the one where the file is saved!) and that drEEM is properly installed.
% 
% Next, standard folder names are a good idea. E.g. store raw data in a folder 
% called "raw data". Separate absorbance data in e.g. "absorbance data". If you 
% don't change these names, you can reuse the same import script. Example to _copy_ 
% (don't try to run it, it will produce errors):
%%
% 
%   clearvars
%   close all
%   cd(fileparts(matlab.desktop.editor.getActiveFilename))
%   tbx=drEEMtoolbox;
%   
%   projectName='someNiceDataset';
%   
%   if not(exist([projectName,'.mat']
%       cd 'raw data'
%       samples=tbx.importeems('* - Waterfall Plot Sample.dat');
%       blanks=tbx.importeems('* - Waterfall Plot Blank.dat');
%       absorbance=tbx.importabsorbance('* - Abs Spectra Graphs.dat');
%       cd ..
%       save([projectName,'.mat'],"samples","blanks","absorbance")
%   else
%       load([projectName,'.mat'])
%   end
%
%% 
% This code will only import the files if the rawdata mat-file doesn't exist 
% yet (don't do this if you keep adding samples into an ongoing project).
% Working with filenames
% Working with strings, cell array of strings (or characters) is really important. 
% This is where some knowledge of Matlab will pay off. Often, we need to find 
% samples, erase, or replace parts of strings or certain sample names or identify 
% issues when sample datasets need to be aligned. _*Though, generally, the more 
% attention you pay to sample names and make sure things align at the stage of 
% measuring, the less you need to do in Matlab!*_
% 
% Some functions that come in extremely handy:
%% 
% * |contains|: Find samples that contain a certain string. No complete match 
% is necessary (though that can be dangerous). But useful particularly if you 
% want to find groups of samples. Example:
%%
% 
%   idx=contains(data.filelist,'my first bad sample')
%   data=tbx.subdataset(data,outSample=idx);
%
%% 
% * |matches:| Much like contains, you'll find samples where the search string 
% is matched _entirely_. Like |contains|, |matches| does case-sensitive lookups.
% * |lower / upper|: If you have a dataset where upper and lower case is mixed 
% up, these two functions can be a life saver because these mixups are eliminated.
%%
% 
%   idx=contains(lower(data.filelist),'my first bad sample')
%   data=tbx.subdataset(data,outSample=idx);
%
%% 
% * |erase|: Super helpful to fix mismatches between sample logs and filenames. 
% Imagine all filenames in a metadata Excel sheet were typed in with the file 
% extension, but this extension is deleted during the import of the samples. Example:
%%
% 
%   data.metadata.absorbanceFileName=erase(data.metadata.absorbanceFileName,'.csv')
%
%% 
% * |intersect|: A very useful function to find common strings between two lists. 
% drEEMs |alignsamples| uses this function and generally will take care of many 
% relevant operations to align different datasets, but it is sometimes necessary 
% to take manual action to figure out what's going wrong when there seems to be 
% little overlap between datasets. Example:
%%
% 
%   [C,ia,ib] = intersect(samples.filelist,absorbance.filelist)
%   
%   notMatchedAbs=absorbance.filelist(setdiff(1:absorbance.nSample,ib);
%   notMatchedEEM=samples.filelist(setdiff(1:samples.nSample,ia);
%   disp(notMatchedAbs)
%   disp(notMatchedEEM)
%
%% drEEM-specific Tips and Tricks
% Correcting filename errors
% Say you made a mistake in naming one of your samples. It was supposed to be 
% called "PCEP26" but accidentally got called "LCEP26". You could fix the filename(s), 
% but you can also handle this sort of issue in Matlab:
%%
% 
%   load("benchmarkDataset.mat")
%   idx=matches(data.filelist,'LCEP26');
%   data.filelist{idx}='PCEP26';
%
%% 
% If you're not used to Matlab, the use of "{}" vs. "()" seems strange (especially 
% the third vs. the second line). We chose to store the filenames of your samples 
% in a cell array. This allows us to store character arrays of different lengths 
% together in one variable, but cell arrays can also be a little confusing _because_ 
% they are so flexible as information storage. Luckily, Matlab's internal text-focused 
% functions can and do handle it for us. Long story short, read more <https://www.mathworks.com/help/matlab/cell-arrays.html 
% here> if you are completely unfamiliar with this.
##### SOURCE END #####
-->
</div></body></html>